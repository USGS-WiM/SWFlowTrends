function addCommas(e){e+="";for(var a=e.split("."),i=a[0],t=a.length>1?"."+a[1]:"",n=/(\d+)(\d{3})/;n.test(i);)i=i.replace(n,"$1,$2");return i+t}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,a){return 0==a?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var allLayers;require(["esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","dojo/domReady!"],function(e,a,i,t,n){allLayers=[{groupHeading:"sites",showGroupHeading:!1,includeInLayerList:!1,layers:{"Trend Results":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWFlowTrends/swFlowTrends_test/MapServer/33",options:{id:"trendResults",opacity:1,mode:i.MODE_SNAPSHOT,outFields:["*"],visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},"For layer info":{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWFlowTrends/swFlowTrends_test/MapServer",options:{id:"layerInfo",opacity:1,outFields:["*"],visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!1,hasOpacitySlider:!0,includeLegend:!0}},2012:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu2012_100515_test/ImageServer",options:{id:"lu2012",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},2002:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu2002_100515_test/ImageServer",options:{id:"lu2002",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},1992:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu1992_100515_test/ImageServer",options:{id:"lu1992",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},1982:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu1982_100515_test/ImageServer",options:{id:"lu1982",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}},1974:{url:"https://gis.wim.usgs.gov/arcgis/rest/services/SWTrends/lu1974_100515_test/ImageServer",options:{id:"lu1974",opacity:.5,visible:!1},wimOptions:{type:"layer",layerType:"agisImage",includeInLayerList:!0,exclusiveGroupName:"Land use",hasOpacitySlider:!0,includeLegend:!0}}}}]});var map,allLayers,maxLegendHeight,maxLegendDivHeight,printCount=0,dragInfoWindows=!0,defaultMapCenter=[-94.106,35.729],constObj,currentConstType="",currentSiteNo="",currentConst="Total Phosphorus",currentLayer="wrtdsSites",identifyTask,identifyParams,trendLayerInfos=[];require(["esri/arcgis/utils","esri/Color","esri/map","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Multipoint","esri/geometry/Point","esri/graphicsUtils","esri/layers/FeatureLayer","esri/tasks/IdentifyParameters","esri/tasks/IdentifyTask","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/tasks/LegendLayer","esri/tasks/PrintTask","esri/tasks/PrintParameters","esri/tasks/PrintTemplate","esri/tasks/query","esri/geometry/webMercatorUtils","dojo/dnd/Moveable","dojo/query","dojo/dom","dojo/dom-class","dojo/on","dojo/domReady!"],function(e,a,i,t,n,s,o,r,l,c,d,p,g,u,y,m,f,h,v,b,w,L,S,T,k,x,I,_,q,O,M){function D(){var e="";return e}function C(e,a,i,t,n){return new f({angle:0,xoffset:a,yoffset:i,type:"esriPMS",url:e,contentType:"image/png",width:t,height:n})}function P(){var e=new S;e.map=map;var a=new T;a.exportOptions={width:500,height:400,dpi:300},a.format="PDF",a.layout="TEMPLATE NAME HERE",a.preserveScale=!1;var i=new w;i.layerId="1";var t=[],n=D();a.layoutOptions={titleText:n,authorText:"",copyrightText:"This page was produced by the surface water flow trends mapper",legendLayers:t};a.layoutOptions.titleText;e.template=a;new L("https://gis.wim.usgs.gov/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task")}if(!jQuery.support.cors&&window.XDomainRequest){var z=/^https?:\/\//i,N=/^get|post$/i,E=new RegExp("^"+location.protocol,"i"),j=/\/xml/i;jQuery.ajaxTransport("text html xml json",function(e,a,i){if(e.crossDomain&&e.async&&N.test(e.type)&&z.test(a.url)&&E.test(a.url)){var t=null,n=(a.dataType||"").toLowerCase();return{send:function(i,s){t=new XDomainRequest,/^\d+$/.test(a.timeout)&&(t.timeout=a.timeout),t.ontimeout=function(){s(500,"timeout")},t.onload=function(){var e="Content-Length: "+t.responseText.length+"\r\nContent-Type: "+t.contentType,a={code:200,message:"success"},i={text:t.responseText};try{if("json"===n)try{i.json=JSON.parse(t.responseText)}catch(o){a.code=500,a.message="parseerror"}else if("xml"===n||"text"!==n&&j.test(t.contentType)){var r=new ActiveXObject("Microsoft.XMLDOM");r.async=!0;try{r.loadXML(t.responseText)}catch(o){r=void 0}if(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)throw a.code=500,a.message="parseerror","Invalid XML: "+t.responseText;i.xml=r}}catch(l){throw l}finally{s(a.code,a.message,i,e)}},t.onerror=function(){s(500,"error",{text:t.responseText})},t.open(e.type,e.url),t.send()},abort:function(){t&&t.abort()}}}})}jQuery.support.cors=!0,map=i("mapDiv",{basemap:"topo",center:defaultMapCenter,zoom:5});var G=new t({map:map},"homeButton");G.startup();var H=new n({map:map},"locateButton");H.startup(),$("#legendButton").click(),$(window).resize(function(){}),$("#IEwarnContinue").click(function(){$("#aboutModal").modal({backdrop:"static"}),$("#aboutModal").modal("show")}),-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?$("#IEwarningModal").modal("show"):($("#aboutModal").modal({backdrop:"static"}),$("#aboutModal").modal("show")),$("#printExecuteButton").click(function(e){e.preventDefault(),$(this).button("loading"),P()}),map.on("extent-change",function(e){}),$("#printNavButton").click(function(){}),$("#layerSelect").change(function(){trendLayerInfos=map.getLayer("layerInfo").layerInfos;var e=document.getElementById("layerSelect").value+"_"+$("input[name=trendType]:checked").val()+"_"+$("input[name=trendPeriod]:checked").val();for(var a in trendLayerInfos)if(trendLayerInfos[a].name==e){map.removeLayer(map.getLayer("trendResults"));var i=new u(map.getLayer("layerInfo").url+"/"+a,{id:"trendResults",opacity:1,mode:u.MODE_SNAPSHOT,outFields:["*"],visible:!0});map.addLayer(i)}}),$(".trendPeriod").on("change",function(e){trendLayerInfos=map.getLayer("layerInfo").layerInfos;var a=document.getElementById("layerSelect").value+"_"+$("input[name=trendType]:checked").val()+"_"+$("input[name=trendPeriod]:checked").val();for(var i in trendLayerInfos)if(trendLayerInfos[i].name==a){map.removeLayer(map.getLayer("trendResults"));var t=new u(map.getLayer("layerInfo").url+"/"+i,{id:"trendResults",opacity:1,mode:u.MODE_SNAPSHOT,outFields:["*"],visible:!0});map.addLayer(t)}}),$(".trendType").on("change",function(e){trendLayerInfos=map.getLayer("layerInfo").layerInfos;var a=document.getElementById("layerSelect").value+"_"+$("input[name=trendType]:checked").val()+"_"+$("input[name=trendPeriod]:checked").val();for(var i in trendLayerInfos)if(trendLayerInfos[i].name==a){map.removeLayer(map.getLayer("trendResults"));var t=new u(map.getLayer("layerInfo").url+"/"+i,{id:"trendResults",opacity:1,mode:u.MODE_SNAPSHOT,outFields:["*"],visible:!0});map.addLayer(t)}}),M(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var a=x.webMercatorToGeographic(map.extent.getCenter());if($("#latitude").html(a.y.toFixed(3)),$("#longitude").html(a.x.toFixed(3)),1==dragInfoWindows){var i=_(".title",map.infoWindow.domNode)[0],t=new I(map.infoWindow.domNode,{handle:i});M(t,"FirstMove",function(){var e=_(".outerPointer",map.infoWindow.domNode)[0];O.add(e,"hidden");var e=_(".pointer",map.infoWindow.domNode)[0];O.add(e,"hidden")}.bind(this))}}),M(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),M(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var a=x.webMercatorToGeographic(e.mapPoint);$("#latitude").html(a.y.toFixed(3)),$("#longitude").html(a.x.toFixed(3))}}),M(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=x.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(3)),$("#longitude").html(e.x.toFixed(3))});var R=new o("https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer");M(q.byId("btnStreets"),"click",function(){map.setBasemap("streets"),map.removeLayer(R)}),M(q.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),map.removeLayer(R)}),M(q.byId("btnHybrid"),"click",function(){map.setBasemap("hybrid"),map.removeLayer(R)}),M(q.byId("btnTerrain"),"click",function(){map.setBasemap("terrain"),map.removeLayer(R)}),M(q.byId("btnGray"),"click",function(){map.setBasemap("gray"),map.removeLayer(R)}),M(q.byId("btnNatGeo"),"click",function(){map.setBasemap("national-geographic"),map.removeLayer(R)}),M(q.byId("btnOSM"),"click",function(){map.setBasemap("osm"),map.removeLayer(R)}),M(q.byId("btnTopo"),"click",function(){map.setBasemap("topo"),map.removeLayer(R)}),M(q.byId("btnNatlMap"),"click",function(){map.addLayer(R)}),M(map,"click",function(e){}),$("#siteInfoDiv").lobiPanel({unpin:!1,reload:!1,minimize:!1,close:!1,expand:!1,editTitle:!1,maxWidth:800,maxHeight:500}),$("#siteInfoDiv .dropdown").prepend("<div id='siteInfoClose' title='close'><b>X</b></div>"),$("#siteInfoDiv .dropdown").prepend("<div id='siteInfoMin' title='collapse'><b>_</b></div>"),$("#siteInfoMin").click(function(){$("#siteInfoDiv").css("visibility","hidden")}),$("#siteInfoClose").click(function(){$("#siteInfoDiv").css("visibility","hidden"),map.graphics.clear()});map.on("layer-add",function(e){var i=e.layer.id;e.layer;"trendResults"==i&&map.getLayer(i).on("click",function(e){map.graphics.clear();var t=new b;t.setStyle(b.STYLE_SQUARE),t.setColor(new a([0,0,0,0])),t.setSize("20");var n=new v(v.STYLE_SOLID,new a([0,255,255]),2);t.setOutline(n);var s=(new p(e.mapPoint.x,e.mapPoint.y,map.spatialReference),new c(e.graphic.geometry,t));map.graphics.add(s),$("#siteInfoDiv").css("visibility","visible");var o=$("#siteInfoDiv").data("lobiPanel"),r=$(document).height(),l=$(document).width(),d=.9,g=r*d,u=l*d;500>r&&$("#siteInfoDiv").height(g),500>l&&$("#siteInfoDiv").width(u);var y=e.x,m=e.y;o.setPosition(y,m),1==o.isPinned()&&o.unpin();var f,h=e.graphic.attributes,w="sym_"+$("input[name=trendType]:checked").val()+"_"+$("input[name=trendPeriod]:checked").val(),L=Number(h[w]);if(-.05>L?f="Non-significant trend down":L>=-.05&&-1e-6>=L?f="Significant trend down":L>-1e-6&&1e-6>L?f="No trend":L>=1e-6&&.05>=L?f="Significant trend up":L>.05&&(f="Non-significant trend up"),$("#siteInfoTabPane").empty(),currentLayer=i,"trendResults"==i){var S;S="HCDN"==h.trend_gages_gage_class?"Reference":h.trend_gages_gage_class,currentSiteNo=h.Q2_scaled_deficit,$("#siteInfoTabPane").append("<br/><b>Station Name: </b>"+h.trend_gages_station_nm+"<br/><b>Site number: </b>"+h.trend_gages_site_id+"<br/><b>Gage class: </b>"+S+"<br/><b>Latitude: </b>"+h.trend_gages_dec_lat_va+"<br/><b>Longitude: </b>"+h.trend_gages_dec_long_va+"<br/><b>Drainage area: </b>"+h.trend_gages_drainSqKm+" (km<sup>2</sup>)<br/><b>Trend: </b>"+f)}})}),search_api.create("geosearch",{on_result:function(e){require(["esri/geometry/Extent"],function(a){var i=["GNIS_MAJOR","GNIS_MINOR","ZIPCODE","AREACODE"],t=i.indexOf(e.result.properties.Source);$("#geosearchModal").modal("hide"),-1==t?map.setExtent(new esri.geometry.Extent({xmin:e.result.properties.LonMin,ymin:e.result.properties.LatMin,xmax:e.result.properties.LonMax,ymax:e.result.properties.LatMax,spatialReference:{wkid:4326}}),!0):require(["esri/geometry/Point"],function(a){map.centerAndZoom(new a(e.result.properties.Lon,e.result.properties.Lat),12)})})},include_usgs_sw:!0,include_usgs_gw:!0,include_usgs_sp:!0,include_usgs_at:!0,include_usgs_ot:!0,include_huc2:!0,include_huc4:!0,include_huc6:!0,include_huc8:!0,include_huc10:!0,include_huc12:!0});C("../images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}function a(){$("#aboutModal").modal("show")}$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){a()}),$(".showUserGuide").click(function(){$("#searchTab").trigger("click"),$("#geosearchModal").modal("hide"),$("#aboutModal").modal("hide"),$("#faqModal").modal("hide"),$("#userGuideModal").modal("show")}),$(".showUserGuide2").click(function(){$("#geosearchModal").modal("hide"),$("#aboutModal").modal("hide"),$("#faqModal").modal("hide"),$("#userGuideModal").modal("show"),$("#iconTab").trigger("click"),console.log("Opening tab 2 user guide")}),$(".showUserGuide3").click(function(){$("#geosearchModal").modal("hide"),$("#aboutModal").modal("hide"),$("#faqModal").modal("hide"),$("#userGuideModal").modal("show"),console.log("Opening tab 3 user guide"),$("#layersTab").trigger("click")}),$("#userGuideNav").click(function(){$("#userGuideModal").modal("show"),$("#searchTab").trigger("click")}),$("#trendResultHelp").click(function(){$("#trendResultsHelpBox").slideToggle(200)}),$("#faqNav").click(function(){$("#faqModal").modal("show")}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")}),$("#faq1header").click(function(){$("#faq1body").slideToggle(250)}),$("#faq2header").click(function(){$("#faq2body").slideToggle(250)}),$("#faq3header").click(function(){$("#faq3body").slideToggle(250)}),$("#faq4header").click(function(){$("#faq4body").slideToggle(250)}),$("#faq5header").click(function(){$("#faq5body").slideToggle(250)}),$("#faq6header").click(function(){$("#faq6body").slideToggle(250)}),$("#faq7header").click(function(){$("#faq7body").slideToggle(250)}),$("#faq8header").click(function(){$("#faq8body").slideToggle(250)}),$("#faq9header").click(function(){$("#faq9body").slideToggle(250)}),$("#faq10header").click(function(){$("#faq10body").slideToggle(250)}),$("#faq11header").click(function(){$("#faq11body").slideToggle(250)}),$("#faq12header").click(function(){$("#faq12body").slideToggle(250)}),$("#faq13header").click(function(){$("#faq13body").slideToggle(250)}),$(".fullsize").click(function(){var e=window.open($(this).attr("src"),"_blank");e.focus()}),$("#faq1header").click(function(){"none"==$("#angle1").css("transform")?$("#angle1").css("transform","rotate(90deg)"):$("#angle1").css("transform","")}),$("#faq2header").click(function(){"none"==$("#angle2").css("transform")?$("#angle2").css("transform","rotate(90deg)"):$("#angle2").css("transform","")}),$("#faq3header").click(function(){"none"==$("#angle3").css("transform")?$("#angle3").css("transform","rotate(90deg)"):$("#angle3").css("transform","")}),$("#faq4header").click(function(){"none"==$("#angle4").css("transform")?$("#angle4").css("transform","rotate(90deg)"):$("#angle4").css("transform","")}),$("#faq5header").click(function(){"none"==$("#angle5").css("transform")?$("#angle5").css("transform","rotate(90deg)"):$("#angle5").css("transform","")}),$("#faq6header").click(function(){"none"==$("#angle6").css("transform")?$("#angle6").css("transform","rotate(90deg)"):$("#angle6").css("transform","")}),$("#faq7header").click(function(){"none"==$("#angle7").css("transform")?$("#angle7").css("transform","rotate(90deg)"):$("#angle7").css("transform","")}),$("#faq8header").click(function(){"none"==$("#angle8").css("transform")?$("#angle8").css("transform","rotate(90deg)"):$("#angle8").css("transform","")}),$("#faq9header").click(function(){"none"==$("#angle9").css("transform")?$("#angle9").css("transform","rotate(90deg)"):$("#angle9").css("transform","")}),$("#faq10header").click(function(){"none"==$("#angle10").css("transform")?$("#angle10").css("transform","rotate(90deg)"):$("#angle10").css("transform","")}),$("#faq11header").click(function(){"none"==$("#angle11").css("transform")?$("#angle11").css("transform","rotate(90deg)"):$("#angle11").css("transform","")}),$("#faq12header").click(function(){"none"==$("#angle12").css("transform")?$("#angle12").css("transform","rotate(90deg)"):$("#angle12").css("transform","")}),$("#faq13header").click(function(){"none"==$("#angle13").css("transform")?$("#angle13").css("transform","rotate(90deg)"):$("#angle13").css("transform","")})}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/SpatialReference","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","dijit/form/CheckBox","dijit/form/RadioButton","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on"],function(e,a,i,t,n,o,r,l,c,d,p,g,u,y,m,f,h,v,b,w){function L(e,a,i,t,n,s,o){if(map.addLayer(i),T.push([n,camelize(t),i]),n){if(!$("#"+camelize(n)).length){var r;if("Data Source"==n)var r=$('<div id="'+camelize(n+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+n+'<span id="info'+camelize(n)+'" title="Data Source identifies the scale, year and emulsion of the imagery that was used to map the wetlands and riparian areas for a given area. It also identifies areas that have Scalable data, which is an interim data product in areas of the nation where standard compliant wetland data is not yet available. Click for more info on Scalable data." class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(n)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button> </div>');else var r=$('<div id="'+camelize(n+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+n+"</button> </div>");r.click(function(e){r.find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$.each(T,function(e,a){var i=map.getLayer(a[2].id);if(a[0]==n)if($("#"+a[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&r.find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",a[1]),map.addLayer(a[2]);var i=map.getLayer(a[2].id);i.setVisibility(!0)}else if(r.find("i.glyphspan").hasClass("fa-square-o")){console.log("removing layer: ",a[1]);var i=map.getLayer(a[2].id);i.setVisibility(!1)}})});var l=$('<div id="'+camelize(n)+'" class="btn-group-vertical" data-toggle="buttons"></div>');$("#toggle").append(l),console.log("here")}if(i.visible)var c=$('<div id="'+camelize(t)+'" class="btn-group-vertical lyrTog radioTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(n)+'" autocomplete="off"><i class="glyphspan fa fa-dot-circle-o '+camelize(n)+'"></i>&nbsp;&nbsp;'+t+"</label> </div>");else var c=$('<div id="'+camelize(t)+'" class="btn-group-vertical lyrTog radioTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(n)+'" autocomplete="off"><i class="glyphspan fa fa-circle-o '+camelize(n)+'"></i>&nbsp;&nbsp;'+t+"</label> </div>");$("#"+camelize(n)).append(c),c.click(function(e){if($(this).find("i.glyphspan").hasClass("fa-circle-o")){$(this).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o");var a=$(this)[0].id;$.each(T,function(e,i){if(i[0]==n)if(i[1]==a&&$("#"+camelize(n+" Root")).find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",i[1]),map.addLayer(i[2]);var t=map.getLayer(i[2].id);t.setVisibility(!0)}else if(i[1]==a&&$("#"+camelize(n+" Root")).find("i.glyphspan").hasClass("fa-square-o"))console.log("group heading not checked");else{console.log("removing layer: ",i[1]);var t=map.getLayer(i[2].id);t.setVisibility(!1),$("#"+i[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&$("#"+i[1]).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o")}})}})}else if(o.includeInLayerList){if(i.visible&&void 0!==o.hasOpacitySlider&&1==o.hasOpacitySlider&&void 0!==o.moreinfo&&o.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+t+'<span id="info'+camelize(t)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(t)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button></div>');else if(!i.visible&&void 0!==o.hasOpacitySlider&&1==o.hasOpacitySlider&&void 0!==o.moreinfo&&o.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+t+'<span id="info'+camelize(t)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></span><span id="opacity'+camelize(t)+'" style="padding-right: 5px" class="glyphspan glyphicon glyphicon-adjust pull-right"></span></button></div>');else if(i.visible&&void 0!==o.hasOpacitySlider&&1==o.hasOpacitySlider)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+t+'<span id="info'+camelize(t)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></button></span></div>');else if(i.visible||void 0===o.hasOpacitySlider||1!=o.hasOpacitySlider)if(i.visible&&void 0!==o.moreinfo&&o.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+t+'<span id="opacity'+camelize(t)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></span></div>');else if(!i.visible&&void 0!==o.moreinfo&&o.moreinfo)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+t+'<span id="info'+camelize(t)+'" title="more info" class="glyphspan glyphicon glyphicon-question-sign pull-right"></button></span></div>');else if(i.visible)var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+t+"</button></span></div>");else var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+t+"</button> </div>");else var c=$('<div class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+t+'<span id="opacity'+camelize(t)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></span></div>');c.click(function(e){$(this).find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$(this).find("button").button("toggle"),i.visible?i.setVisibility(!1):i.setVisibility(!0),o.otherLayersToggled&&$.each(o.otherLayersToggled,function(e,a){var t=map.getLayer(a);t.setVisibility(i.visible)})})}if(void 0!==a){var d=camelize(e);if(!$("#"+d).length){if(a)var p=$('<div id="'+d+'"><div class="alert alert-info" role="alert"><strong>'+e+"</strong></div></div>");else var p=$('<div id="'+d+'"></div>');$("#toggle").append(p)}if(n){if($("#"+d).append(r),$("#"+d).append(l),void 0!==o.moreinfo&&o.moreinfo){var g="#info"+camelize(n),u=$(g);u.click(function(e){window.open(o.moreinfo,"_blank"),e.preventDefault(),e.stopPropagation()})}if($("#opacity"+camelize(n)).length>0){var g="#opacity"+camelize(n),y=$(g);y.click(function(e){e.preventDefault(),e.stopPropagation(),$(".opacitySlider").remove();var a=map.getLayer(s.id).opacity,i=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+a+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(i),$("#slider")[0].value=100*a,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var a=$("#slider")[0].value/100;console.log("o: "+a),$("#opacityValue").html("Opacity: "+a),map.getLayer(s.id).setOpacity(a),o.otherLayersToggled&&$.each(o.otherLayersToggled,function(e,i){var t=map.getLayer(i);t.setOpacity(a)})})})}}else{if($("#"+d).append(c),void 0!==o.moreinfo&&o.moreinfo){var g="#info"+camelize(t),u=$(g);u.click(function(e){window.open(o.moreinfo,"_blank"),e.preventDefault(),e.stopPropagation()})}$("#opacity"+camelize(t)).length>0&&$("#opacity"+camelize(t)).click(function(e){e.preventDefault(),e.stopPropagation(),$(".opacitySlider").remove();var a=map.getLayer(s.id).opacity,i=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+a+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(i),$("#slider")[0].value=100*a,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var a=$("#slider")[0].value/100;console.log("o: "+a),$("#opacityValue").html("Opacity: "+a),map.getLayer(s.id).setOpacity(a),o.otherLayersToggled&&$.each(o.otherLayersToggled,function(e,i){var t=map.getLayer(i);t.setOpacity(a)})})})}}else if($("#toggle").append(c),void 0!==o.moreinfo&&o.moreinfo){var g="#info"+camelize(t),u=$(g);u.click(function(e){alert(e.currentTarget.id),e.preventDefault(),e.stopPropagation()})}}var S=[],T=[];$.each(allLayers,function(e,a){console.log("processing: ",a.groupHeading),$.each(a.layers,function(e,i){var t=e;("lowQ_1Day"==t||"lowQ_3Days"==t||"lowQ_7Day"==t||"mean_annual"==t||"peak_square_data"==t||"zeroQ_nDays"==t)&&(t=e);var n="";if(i.wimOptions.exclusiveGroupName&&(n=i.wimOptions.exclusiveGroupName),"agisFeature"===i.wimOptions.layerType){var o=new c(i.url,i.options);void 0!==i.wimOptions.renderer&&o.setRenderer(i.wimOptions.renderer),i.wimOptions&&1==i.wimOptions.includeLegend&&S.push({layer:o,title:t}),L(a.groupHeading,a.showGroupHeading,o,e,n,i.options,i.wimOptions)}else if("agisWMS"===i.wimOptions.layerType){var o=new p(i.url,{resourceInfo:i.options.resourceInfo,visibleLayers:i.options.visibleLayers},i.options);i.wimOptions&&1==i.wimOptions.includeLegend&&S.push({layer:o,title:t}),L(a.groupHeading,a.showGroupHeading,o,e,n,i.options,i.wimOptions)}else if("agisDynamic"===i.wimOptions.layerType){var o=new l(i.url,i.options);if(i.visibleLayers&&o.setVisibleLayers(i.visibleLayers),i.wimOptions&&i.wimOptions.layerDefinitions){var r=[];$.each(i.wimOptions.layerDefinitions,function(e,a){r[e]=a}),o.setLayerDefinitions(r)}i.wimOptions&&1==i.wimOptions.includeLegend&&S.push({layer:o,title:t}),L(a.groupHeading,a.showGroupHeading,o,e,n,i.options,i.wimOptions)}else if("agisImage"===i.wimOptions.layerType){var o=new s(i.url,i.options);i.wimOptions&&1==i.wimOptions.includeLegend&&S.push({layer:o,title:t}),i.visibleLayers&&o.setVisibleLayers(i.visibleLayers),L(a.groupHeading,a.showGroupHeading,o,e,n,i.options,i.wimOptions)}})});var k=new e({map:map,layerInfos:S},"legendDiv");k.startup()})}),$(document).ready(function(){});